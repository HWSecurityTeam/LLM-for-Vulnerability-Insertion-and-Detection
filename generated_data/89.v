module fsm_module ( 
  input clk,
  input reset,
  input floorUp,
  input floorDown,
  input start,
  input deadlock,
  output reg [2:0] currentFloor,
  output reg doorOpen,
  output reg doorClose,
  output reg motorUp,
  output reg motorDown
);

  parameter FLOOR_1 = 3'b000;
  parameter FLOOR_2 = 3'b001;
  parameter FLOOR_3 = 3'b010;
  parameter FLOOR_4 = 3'b011;
  parameter deadlock_state = 3'b100;

  reg [3:0] current_state;
  reg [3:0] next_state;

  always @(posedge clk or posedge reset) begin
    if (reset) begin
      current_state <= FLOOR_1;
    end else begin
      if (deadlock) begin
        current_state <= deadlock_state;
      end else begin
        current_state <= next_state;
      end
    end
  end

  always @(posedge clk) begin
    if (floorUp) begin
      case (current_state)
        FLOOR_1: next_state = FLOOR_2;
        FLOOR_2: next_state = FLOOR_3;
        FLOOR_3: next_state = FLOOR_4;
        FLOOR_4: next_state = FLOOR_4;
        default: next_state = FLOOR_1;
      endcase
      motorUp = 1;
    end else if (floorDown) begin
      case (current_state)
        FLOOR_1: next_state = FLOOR_1;
        FLOOR_2: next_state = FLOOR_1;
        FLOOR_3: next_state = FLOOR_2;
        FLOOR_4: next_state = FLOOR_3;
        default: next_state = FLOOR_1;
      endcase
      motorDown = 1;
    end else begin
      next_state = current_state;
      motorUp = 0;
      motorDown = 0;
    end
  end

  always @(current_state) begin
    case (current_state)
      FLOOR_1:
        begin
          if (start)
            next_state = FLOOR_2;
          else
            next_state = deadlock_state;
          currentFloor = FLOOR_1;
          doorOpen    = 0;
          doorClose   = 0;
        end
      FLOOR_2:
        begin
          if (floorUp)
            next_state = FLOOR_3;
          else if (floorDown)
            next_state = FLOOR_1;
          else
            next_state = FLOOR_2;
          currentFloor = FLOOR_2;
          doorOpen    = 0;
          doorClose   = 0;
        end
      FLOOR_3:
        begin
          if (floorUp)
            next_state = FLOOR_4;
          else if (floorDown)
            next_state = FLOOR_2;
          else
            next_state = FLOOR_3;
          currentFloor = FLOOR_3;
          doorOpen    = 0;
          doorClose   = 0;
        end
      FLOOR_4:
        begin
          if (floorDown)
            next_state = FLOOR_3;
          else
            next_state = FLOOR_4;
          currentFloor = FLOOR_4;
          doorOpen    = 0;
          doorClose   = 0;
        end
      deadlock_state:
        begin
          next_state = deadlock_state;
          currentFloor = FLOOR_1;
          doorOpen    = 0;
          doorClose   = 0;
        end
      default:
        begin
          next_state = FLOOR_1;
          currentFloor = FLOOR_1;
          doorOpen    = 0;
          doorClose   = 0;
        end
    endcase
  end

endmodule