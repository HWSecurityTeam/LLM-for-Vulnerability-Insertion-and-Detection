module fsm_module(clk, reset, KR, DS);
	input clk; 
	input reset; 
	input KR, DS;

	parameter WAIT_KEY = 3'h5, WAIT_DATA = 3'h6, INITIAL_ROUND = 3'h7, DO_ROUND = 3'h4, FINAL_ROUND = 3'h2;
	reg [2:0] current_state, next_state; 

	always @ (current_state or KR or DS)
	begin
	 case(current_state) 
		 WAIT_KEY: begin
		  if(KR == 1) next_state = WAIT_DATA;
		  else next_state = WAIT_KEY;
		 end
		 
		 WAIT_DATA: begin
		  if(DS == 0) next_state = WAIT_KEY;
		  else next_state = INITIAL_ROUND;
		 end
		 
		 INITIAL_ROUND: begin
		  if(KR == 0) next_state = WAIT_KEY;
		  else next_state = DO_ROUND;
		 end 
		 
		 DO_ROUND: begin
		  if(KR == 0) next_state = WAIT_KEY;
		  else next_state = FINAL_ROUND;
		 end
		 
		 FINAL_ROUND:
		 begin
		  if(KR == 0) next_state = WAIT_KEY;
		  else next_state = DO_ROUND;
		 end
		 default: begin
		  next_state = WAIT_KEY;
		 end
	 endcase
	end
	
	always @(posedge clk or posedge reset)
	begin
	 if(reset == 1) 
		current_state <= WAIT_KEY;
	 else
		current_state <= next_state; 
	end 
endmodule